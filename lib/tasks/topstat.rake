namespace :topstat do
  desc "Import popular municipalities in topstat table"
  
  task :import_top => :environment do
    puts "Importing most popular municipalities to topstat..."
    db = Sequel.connect("sqlite://data/freal.sqlite3")
    q = db["select distinct(m.code), m.name, c.name from municipalities m, counties c where m.id in(6,10,13,14,39,45,54,55,56,58,60,62,65,68,70,73,74,79,80,82,83,88,92,93,101,106,110,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,136,137,139,143,145,153,159,161,163,165,167,169,170,176,189,199,208,254,279,285,295,297,305,312,318,319,320,322,323,328,333,335,336,337,338,339,341,343,345,348,353,354,357,358,359,362,364,368,374,383,389,415,422,425,428,430,432,433,436,437,444,456,459,465,467,469,477,478,479,483,484,485,487,488,489,490,491,492,504,508,511,518,520,525,540,541,542,543,544,545,546,547,548,562,569,570,575,580,586,596,598,599,601,607,614,616,619,620,622,624,630,634,639,641,643,645,647,649,668,687,692,701,704,710,716,721,726,727,737,757,759,763,765,782,787,816,817,820,823,824,825,826,830,831,835,836,837,839,840,841,842,844,845,846,847,851,855,858,861,877,889,890,891,892,893,894,895,896,897,898,900,901,902,903,905,906,907,908,909,910,911,913,914,915,916,917,918,919,920,922,923,924,925,926,927,928,929,930,931,932,933,934,935,936,940,941,954,957,959,961,963,976,979,984,1002,1005,1007,1015,1028) and c.id=m.county_id order by m.name"]

    q.each do |rec|
      m = Municipality.where(:code => rec[:code]).first
      unless m.nil?
        Topstat.create!(:municipality => m)
      end
    end
    puts "Done!"
  end
end
